___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_HubSpt_Contact_Event",
  "version": 1,
  "displayName": "HubSpot - Contact & Behavioral Event",
  "categories": ["ANALYTICS", "CONVERSIONS", "MARKETING"],
  "brand": {
    "id": "github.com_stangommans",
    "displayName": "Stan Gommans",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "First creates/updates a HubSpot contact via CRM API, then triggers a Custom Behavioral Event.",
  "containerContexts": ["SERVER"]
}

___TEMPLATE_PARAMETERS___
[
  {
    "type": "TEXT",
    "name": "apiKey",
    "displayName": "Private App Access Token",
    "simpleValueType": true,
    "valueValidators": [{ "type": "NON_EMPTY" }]
  },
  {
    "type": "GROUP",
    "name": "contactGroup",
    "displayName": "Step 1: Contact Properties",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "email",
        "displayName": "Email",
        "simpleValueType": true,
        "valueValidators": [{ "type": "NON_EMPTY" }]
      },
      {
        "type": "TEXT",
        "name": "firstname",
        "displayName": "First Name",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "lastname",
        "displayName": "Last Name",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "phone",
        "displayName": "Phone Number",
        "simpleValueType": true
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "additionalContactProperties",
        "displayName": "Additional Contact Properties",
        "simpleTableColumns": [
          { "name": "property", "displayName": "Internal Name", "type": "TEXT" },
          { "name": "value", "displayName": "Value", "type": "TEXT" }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "eventGroup",
    "displayName": "Step 2: Custom Behavioral Event",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "eventName",
        "displayName": "Internal Event Name",
        "simpleValueType": true,
        "help": "The internal name found in HubSpot (e.g. pe123_my_event)",
        "valueValidators": [{ "type": "NON_EMPTY" }]
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "eventProperties",
        "displayName": "Event Properties",
        "simpleTableColumns": [
          { "name": "property", "displayName": "Property Name", "type": "TEXT" },
          { "name": "value", "displayName": "Value", "type": "TEXT" }
        ]
      },
      {
        "type": "TEXT",
        "name": "occurredAt",
        "displayName": "Occurred At (ISO8601)",
        "simpleValueType": true,
        "help": "Leave blank for current time."
      }
    ]
  },
  {
    "displayName": "Logs Settings",
    "name": "logsGroup",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "type": "RADIO",
        "name": "logType",
        "radioItems": [
          { "value": "no", "displayValue": "Do not log" },
          { "value": "debug", "displayValue": "Log during debug/preview" },
          { "value": "always", "displayValue": "Always log" }
        ],
        "simpleValueType": true,
        "defaultValue": "debug"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

const sendHttpRequest = require('sendHttpRequest');
const JSON = require('JSON');
const getRequestHeader = require('getRequestHeader');
const makeTableMap = require('makeTableMap');
const makeInteger = require('makeInteger');
const Promise = require('Promise'); // Added requirement
const logToConsole = require('logToConsole');
const getContainerVersion = require('getContainerVersion');

const isLoggingEnabled = determinateIsLoggingEnabled();
const traceId = getRequestHeader('trace-id');

// 1. Prepare Contact Data
const contactProperties = data.additionalContactProperties 
  ? makeTableMap(data.additionalContactProperties, 'property', 'value') 
  : {};

if (data.email) contactProperties.email = data.email;
if (data.firstname) contactProperties.firstname = data.firstname;
if (data.lastname) contactProperties.lastname = data.lastname;
if (data.phone) contactProperties.phone = data.phone;

// 2. Start Sequential Process: Update/Create Contact THEN Send Event
upsertContact(contactProperties)
  .then(() => {
    return sendBehavioralEvent();
  })
  .then(() => {
    data.gtmOnSuccess();
  })
  .catch((err) => {
    if (isLoggingEnabled) logToConsole('HubSpot Tag Error: ' + err);
    data.gtmOnFailure();
  });

/******************************************************************************/

function upsertContact(properties) {
  const searchUrl = 'https://api.hubapi.com/crm/v3/objects/contacts/search';
  const searchBody = {
    filterGroups: [{
      filters: [{ value: data.email, propertyName: 'email', operator: 'EQ' }]
    }]
  };

  logRequest('Contact Search', 'POST', searchUrl, searchBody);

  return sendHttpRequest(searchUrl, {
    headers: getHeaders(),
    method: 'POST'
  }, JSON.stringify(searchBody)).then((result) => {
    logResponse(result.statusCode, result.headers, result.body, 'Contact Search');
    
    if (result.statusCode < 200 || result.statusCode >= 300) {
      return Promise.reject('Search Failed with status ' + result.statusCode);
    }

    const parsed = JSON.parse(result.body);
    const contactExists = makeInteger(parsed.total) > 0;
    
    let url = 'https://api.hubapi.com/crm/v3/objects/contacts';
    let method = 'POST';
    
    if (contactExists) {
      const contactId = parsed.results[0].id;
      url = url + '/' + contactId;
      method = 'PATCH';
    }

    logRequest('Contact Upsert', method, url, { properties: properties });

    return sendHttpRequest(url, {
      headers: getHeaders(),
      method: method
    }, JSON.stringify({ properties: properties }));
  }).then((result) => {
    logResponse(result.statusCode, result.headers, result.body, 'Contact Upsert');
    if (result.statusCode >= 200 && result.statusCode < 300) return true;
    return Promise.reject('Upsert Failed with status ' + result.statusCode);
  });
}

function sendBehavioralEvent() {
  const url = 'https://api.hubapi.com/events/v3/send';
  const bodyData = {
    eventName: data.eventName,
    email: data.email,
    properties: data.eventProperties
      ? makeTableMap(data.eventProperties, 'property', 'value')
      : {}
  };

  if (data.occurredAt) bodyData.occurredAt = data.occurredAt;

  logRequest('Behavioral Event', 'POST', url, bodyData);

  return sendHttpRequest(url, {
    headers: getHeaders(),
    method: 'POST'
  }, JSON.stringify(bodyData)).then((result) => {
    logResponse(result.statusCode, result.headers, result.body, 'Behavioral Event');
    if (result.statusCode >= 200 && result.statusCode < 300) return true;
    return Promise.reject('Event Failed with status ' + result.statusCode);
  });
}

function getHeaders() {
  return {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer ' + data.apiKey
  };
}

function logResponse(statusCode, headers, body, eventName) {
  if (isLoggingEnabled) {
    logToConsole(JSON.stringify({
      Name: 'HubSpot',
      Type: 'Response',
      TraceId: traceId,
      Event: eventName,
      Status: statusCode,
      Body: body
    }));
  }
}

function logRequest(eventName, method, url, body) {
  if (isLoggingEnabled) {
    logToConsole(JSON.stringify({
      Name: 'HubSpot',
      Type: 'Request',
      TraceId: traceId,
      Event: eventName,
      Method: method,
      Url: url,
      Body: body
    }));
  }
}

function determinateIsLoggingEnabled() {
  const cv = getContainerVersion();
  const isDebug = !!(cv && (cv.debugMode || cv.previewMode));
  if (data.logType === 'no') return false;
  if (data.logType === 'always') return true;
  return isDebug;
}


___SERVER_PERMISSIONS___
[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://api.hubapi.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "headerWhitelist",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "trace-id"
                  }
                ]
              }
            ]
          }
        },
        {
          "key": "headersAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]